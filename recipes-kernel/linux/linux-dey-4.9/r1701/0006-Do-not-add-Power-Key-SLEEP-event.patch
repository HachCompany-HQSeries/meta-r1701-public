From c8222fb6ed79d332334b86e1e0f60d9ce3612c70 Mon Sep 17 00:00:00 2001
From: Devang Patel <dpatel@hach.com>
Date: Mon, 2 Jul 2018 11:12:14 -0600
Subject: [PATCH 6/9] Do not add Power Key SLEEP event

---
 drivers/input/misc/pwrkey-mca-cc6ul.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/input/misc/pwrkey-mca-cc6ul.c b/drivers/input/misc/pwrkey-mca-cc6ul.c
index 7ea7809ae205..696c5e55d5e5 100644
--- a/drivers/input/misc/pwrkey-mca-cc6ul.c
+++ b/drivers/input/misc/pwrkey-mca-cc6ul.c
@@ -221,9 +221,6 @@ static int mca_cc6ul_pwrkey_probe(struct platform_device *pdev)
 	pwrkey->input->phys = MCA_CC6UL_DRVNAME_PWRKEY "/input0";
 	pwrkey->input->dev.parent = &pdev->dev;
 
-	input_set_capability(pwrkey->input, EV_KEY, KEY_POWER);
-	input_set_capability(pwrkey->input, EV_KEY, KEY_SLEEP);
-
 	/* Initialize driver settings from device tree */
 	ret = of_mca_cc6ul_pwrkey_read_settings(np, pwrkey);
 	if (ret) {
@@ -239,6 +236,7 @@ static int mca_cc6ul_pwrkey_probe(struct platform_device *pdev)
 	}
 
 	if (pwrkey->key_power) {
+        input_set_capability(pwrkey->input, EV_KEY, KEY_POWER);
 		ret = devm_request_threaded_irq(&pdev->dev, pwrkey->irq_power, NULL,
 						mca_cc6ul_pwrkey_power_off_irq_handler,
 						IRQF_TRIGGER_LOW | IRQF_ONESHOT,
@@ -248,9 +246,11 @@ static int mca_cc6ul_pwrkey_probe(struct platform_device *pdev)
 				MCA_CC6UL_IRQ_PWR_OFF_NAME, pwrkey->irq_power);
 			goto err_free_inputdev;
 		}
+		//enable_irq_wake(pwrkey->irq_power);
 	}
 
 	if (pwrkey->key_sleep) {
+        input_set_capability(pwrkey->input, EV_KEY, KEY_SLEEP);
 		ret = devm_request_threaded_irq(&pdev->dev, pwrkey->irq_sleep, NULL,
 						mca_cc6ul_pwrkey_sleep_irq_handler,
 						IRQF_TRIGGER_LOW | IRQF_ONESHOT,
-- 
2.11.0

