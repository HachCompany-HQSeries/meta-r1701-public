#@TYPE: Machine
#@NAME: HACH r1701 platform
#@DESCRIPTION: Machine configuration for r1701 platform.

# Include the machine configuration for Digi's ConnectCore 6UL.
include conf/machine/include/ccimx6ul.inc

# Set software version, this version is the version of r1701 firmware
SOFTWARE_VERSION = "0.0.8"

# U-Boot configurations
# Last one is the default (the one the symlinks point at)
UBOOT_CONFIG ??= "r1701"
UBOOT_CONFIG[r1701] = "r1701_defconfig"

# U-Boot environment offset (within partition)
UBOOT_ENV_OFFSET ?= "0x0"

# U-Boot environment size
UBOOT_ENV_SIZE ?= "0x20000"

# U-Boot environment range: size (in hex) in the environment partition that
# the U-Boot environment can take up (if undefined, it will take up all the
# available space in the environment partition)
UBOOT_ENV_RANGE ?= ""

KERNEL_DEVICETREE ?= " \
    imx6ul-r1701.dtb \
    imx6ul-r1701-wb.dtb \
"

# Recovery initramfs image name.
RECOVERY_INITRAMFS_IMAGE = "hach-image-recovery-initramfs"

SERIAL_CONSOLES ?= "115200;ttymxc4"

# Bluetooth tty
#BT_TTY ?= "ttymxc0"

# U-Boot script to be copied to the boot image
BOOT_SCRIPTS = "boot.scr:boot.scr"

# Flash image types
IMAGE_FSTYPES ?= "tar.bz2 ubifs boot.ubifs recovery.ubifs"

# Adding HACH custom kernel modules dependency and make them auto load at startup
MACHINE_EXTRA_RDEPENDS += "kernel-module-mipdisplay-3-2-inch"
KERNEL_MODULE_AUTOLOAD += "mipdisplay-3-2-inch"

#Automatically load the usb battery charger driver
KERNEL_MODULE_AUTOLOAD += "bq25890_charger"

# Remove wireless feature.
MACHINE_FEATURES_remove += "wifi bluetooth"
WIRELESS_MODULE_remove = " ${@base_conditional('HAVE_WIFI', '1', 'kernel-module-qualcomm', '', d)}"
MACHINE_FIRMWARE_remove = " ${@base_conditional('HAVE_BT', '1', 'firmware-qualcomm-qca6564-bt', '', d)}"
MACHINE_FIRMWARE_remove = " ${@base_conditional('HAVE_WIFI', '1', 'firmware-qualcomm-qca6564-wifi', '', d)}"

#Remove sound and touchscreen related features.
MACHINE_EXTRA_RRECOMMENDS_remove = "imx-alsa-plugins"
MACHINE_FEATURES_remove += "alsa touchscreen"

# Extra machine features.
MACHINE_FEATURES += "vfat ext4"
